interface VulnerabilityMapping {
  pattern: RegExp;
  type: string;
  description: string;
}

export const VULNERABILITY_MAPPINGS: VulnerabilityMapping[] = [
  {
    pattern: /cross.?site\s+scripting|xss|html\s+injection|dom\s+manipulation.*untrusted/i,
    type: 'Cross-Site scripting (XSS)',
    description: 'A vulnerability that enables attackers to inject malicious scripts into web pages'
  },
  {
    pattern: /cross.?frame\s+scripting|xfs/i,
    type: 'Cross-Frame Scripting (XFS)',
    description: 'A vulnerability related to frame and iframe manipulation'
  },
  {
    pattern: /cross.?site\s+request\s+forgery|csrf/i,
    type: 'Cross-Site Request Forgery (CSRF)',
    description: 'A vulnerability that forces users to perform unwanted actions'
  },
  // ... add other mappings similarly
];

export function findRelevantVulnerabilityTypes(description: string): string[] {
  const relevantTypes: string[] = [];
  
  for (const mapping of VULNERABILITY_MAPPINGS) {
    // Check if the pattern matches and the type is relevant to the context
    if (mapping.pattern.test(description.toLowerCase())) {
      relevantTypes.push(mapping.type);
    }
  }
  
  return relevantTypes;
}

export const VULNERABILITY_ALIASES = {
    'XSS': 'Cross-Site scripting (XSS)',
    'Cross-site Scripting': 'Cross-Site scripting (XSS)',
    'XFS': 'Cross-Frame Scripting (XFS)',
    'XML': 'XML External Entity (XXE)',
    'DoS': 'Denial-of-service (DoS)',
    'Denial of Service': 'Denial-of-service (DoS)',
    'process to crash': 'Denial-of-service (DoS)',
    'crashed': 'Denial-of-service (DoS)',
    'crash': 'Denial-of-service (DoS)',
    'SSRF': 'Server-side Request Forgery (SSRF)',
    'CSRF': 'Cross-Site Request Forgery (CSRF)',
    'Object.prototype pollution': 'Prototype Pollution',
    'execute arbitrary code': 'Remote Code Execution (RCE)',
    'RCE': 'Remote Code Execution (RCE)',
    'spoof DNS responses': 'DNS Response Spoofing',
    'read secret data': 'Information Disclosure',
    'disclose information': 'Information Disclosure',
    'bypass IP based authentication': 'Authentication Bypass',
    'SQL Injection': 'SQL Injection (SQLi)',
    'SQLi': 'SQL Injection (SQLi)',
    'write beyond the end of a buffer': 'Buffer Overflow',
    'overflow a buffer': 'Buffer Overflow',
    'overrun a buffer': 'Buffer Overflow',
    'integer overflow': 'Integer Overflow',
    'out of bounds writes': 'Buffer Overflow',
    'write outside of allocated memory': 'Buffer Overflow',
    'forward the request to': 'Server-Side Request Forgery (SSRF)',
    'allows local users to gain privileges': 'Privilege Escalation',
    'gain elevated access to resources': 'Privilege Escalation',
    'response headers to be truncated early': 'HTTP Response Splitting',
    'headers being incorporated into the response body': 'HTTP Response Splitting',
    'hijack authentication': 'Cross-Site Request Forgery (CSRF)',
    'forge request': 'Cross-Site Request Forgery (CSRF)',
    'request forgery': 'Cross-Site Request Forgery (CSRF)',
    'manipulate request': 'Cross-Site Request Forgery (CSRF)',
    'hijack session': 'Cross-Site Request Forgery (CSRF)',
    'manipulate application deployment': 'Cross-Site Request Forgery (CSRF)',
    'unauthorized request': 'Cross-Site Request Forgery (CSRF)',
    'unauthorized access': 'Improper Access Control',
    'privilege escalation': 'Privilege Escalation',
    'unauthorized manipulation': 'Improper Access Control',
    'execute input': 'Code Injection',
    'execute shell': 'Command Injection',
    'path traversal': 'Directory Traversal',
    'weak crypto': 'Cryptographic Issues',
    'broken crypto': 'Cryptographic Issues',
    'lack of authorization': 'Missing Authorization',
    'missing access control': 'Missing Authorization',
    'time of check': 'Race Condition',
    'TOCTOU': 'Race Condition',
    'memory after free': 'Use After Free',
    'deallocated memory': 'Use After Free',
    'resource exhaustion': 'Uncontrolled Resource Consumption',
    'memory leak': 'Uncontrolled Resource Consumption',
    'plaintext data': 'Missing Encryption',
    'unencrypted sensitive': 'Missing Encryption',
    'missing validation': 'Improper Input Validation',
    'insufficient validation': 'Improper Input Validation',
    'IDOR': 'Insecure Direct Object References',
    'direct object reference': 'Insecure Direct Object References',
    'default configuration': 'Security Misconfiguration',
    'weak configuration': 'Security Misconfiguration',
    'arithmetic overflow': 'Integer Overflow',
    'numeric overflow': 'Integer Overflow',
    'unvalidated redirect': 'Open Redirect',
    'redirect without validation': 'Open Redirect',
    'directory manipulation': 'Path Manipulation',
    'file path manipulation': 'Path Manipulation',
    'missing audit': 'Insufficient Logging',
    'no security logging': 'Insufficient Logging',
    'memory not freed': 'Memory Leak',
    'resource leak': 'Memory Leak',
    'format string misuse': 'Format String',
    'printf vulnerability': 'Format String',
    // Common CVE description patterns
    'allows remote attackers': 'Remote Code Execution (RCE)',
    'remote attacker': 'Remote Code Execution (RCE)',
    'allows an attacker': 'Security Vulnerability',
    'malicious client': 'Client-Side Attack',
    'malicious server': 'Server-Side Attack',
    'unauthorized actor': 'Authentication Bypass',
    'without authentication': 'Authentication Bypass',
    'without proper authentication': 'Authentication Bypass',
    'bypass security': 'Security Bypass',
    'security restriction bypass': 'Security Bypass',
    'sandbox escape': 'Sandbox Escape',
    'escape the sandbox': 'Sandbox Escape',
    'privilege elevation': 'Privilege Escalation',
    'escalate privileges': 'Privilege Escalation',
    'gain root': 'Privilege Escalation',
    'gain admin': 'Privilege Escalation',
    'obtain admin': 'Privilege Escalation',
    'heap corruption': 'Memory Corruption',
    'stack corruption': 'Memory Corruption',
    'memory corruption': 'Memory Corruption',
    'use-after-free': 'Use After Free',
    'use after release': 'Use After Free',
    'double free': 'Use After Free',
    'buffer over-read': 'Buffer Overflow',
    'buffer under-read': 'Buffer Overflow',
    'buffer over-write': 'Buffer Overflow',
    'stack overflow': 'Buffer Overflow',
    'heap overflow': 'Buffer Overflow',
    'type confusion': 'Type Confusion',
    'type mismatch': 'Type Confusion',
    'command execution': 'Command Injection',
    'arbitrary commands': 'Command Injection',
    'execute commands': 'Command Injection',
    'code execution': 'Code Injection',
    'arbitrary code': 'Code Injection',
    'execute code': 'Code Injection',
    'sql command': 'SQL Injection (SQLi)',
    'database query': 'SQL Injection (SQLi)',
    'modify sql': 'SQL Injection (SQLi)',
    'crafted request': 'Input Validation',
    'malformed request': 'Input Validation',
    'malicious request': 'Input Validation',
    'crafted input': 'Input Validation',
    'specially crafted': 'Input Validation',
    'improper handling': 'Error Handling',
    'improper check': 'Error Handling',
    'incorrect handling': 'Error Handling',
    'unhandled exception': 'Error Handling',
    'null pointer': 'Null Pointer Dereference',
    'null dereference': 'Null Pointer Dereference',
    'information leak': 'Information Disclosure',
    'sensitive data exposure': 'Information Disclosure',
    'information disclosure': 'Information Disclosure',
    'data exposure': 'Information Disclosure',
    'unintended disclosure': 'Information Disclosure',
    'cross-domain': 'Cross-origin Resource Sharing',
    'cors': 'Cross-origin Resource Sharing',
    'same-origin policy': 'Cross-origin Resource Sharing',
    'origin policy': 'Cross-origin Resource Sharing',
    'cache poisoning': 'Cache Poisoning',
    'poison cache': 'Cache Poisoning',
    'cache pollution': 'Cache Poisoning',
    'clickjacking': 'UI Redressing',
    'click-jacking': 'UI Redressing',
    'ui redressing': 'UI Redressing',
    'race window': 'Race Condition',
    'timing attack': 'Race Condition',
    'race vulnerability': 'Race Condition',
    'brute force': 'Brute Force',
    'brute-force': 'Brute Force',
    'dictionary attack': 'Brute Force',
    'password guessing': 'Brute Force',
    'replay attack': 'Replay Attack',
    'session replay': 'Replay Attack',
    'request replay': 'Replay Attack',
    'bypass authentication mechanism': 'Authentication Bypass',
    'authentication check': 'Authentication Bypass',
    'verify authentication': 'Authentication Bypass',
    'auth bypass': 'Authentication Bypass',
    'access sensitive': 'Improper Access Control',
    'access restricted': 'Improper Access Control',
    'access protected': 'Improper Access Control',
    'gain access': 'Improper Access Control',
    'missing bounds': 'Buffer Overflow',
    'bounds check': 'Buffer Overflow',
    'boundary validation': 'Buffer Overflow',
    'size validation': 'Buffer Overflow',
    'length validation': 'Buffer Overflow',
    'exhaust resources': 'Denial-of-service (DoS)',
    'consume resources': 'Denial-of-service (DoS)',
    'high cpu': 'Denial-of-service (DoS)',
    'high memory': 'Denial-of-service (DoS)',
    'infinite loop': 'Denial-of-service (DoS)'
};

export const PRESET_DESCRIPTIONS = [
    "-",
    "Authentication Bypass",
    "Buffer Overflow",
    "Code Injection",
    "Command Injection",
    "Creation of Temporary File With Insecure Permissions",
    "Cross-Frame Scripting (XFS)",
    "Cross-Site Request Forgery (CSRF)",
    "Cross-Site scripting (XSS)",
    "Cross-origin Resource Sharing",
    "Cryptographic Issues",
    "DNS Response Spoofing",
    "Denial of service (DoS)",
    "Denial-of-service (DoS)",
    "Directory Traversal",
    "Distributed Denial-of-service (DDoS)",
    "Download of Code Without Integrity Check",
    "Execution with Unnecessary Privileges",
    "Exposure of Resource to Wrong Sphere",
    "Exposure of Sensitive Information to an Unauthorized Actor",
    "Failure to Constrain Operations within the Bounds of a Memory Buffer",
    "Failure to Drop Privileges",
    "Failure to Encrypt Sensitive Traffic",
    "Failure to Handle Missing or Unexpected Data",
    "Failure to Preserve Web Page Structure",
    "Failure to Protect Stored Data from Modification",
    "Failure to Provide Confidentiality",
    "Failure to Provide Privacy Notice",
    "HTTP Request Smuggling",
    "Heap-based Buffer Overflow",
    "Improper Access Control",
    "Improper Certificate Validation",
    "Improper Check for Dropped Privileges",
    "Improper Check for Unusual or Exceptional Conditions",
    "Improper Control of Generation of Code",
    "Improper Control of a Resource Through its Lifetime",
    "Improper Enforcement of Message or Data Structure",
    "Improper Handling of Length Parameter Inconsistency",
    "Improper Initialization",
    "Improper Input Validation",
    "Improper Limitation of a Pathname to a Restricted Directory",
    "Improper Neutralization of Special Elements used in an SQL Command",
    "Improper Privilege Management",
    "Improper Resource Shutdown or Release",
    "Improper Restriction of Excessive Authentication Attempts",
    "Improper Restriction of Operations within the Bounds of a Memory Buffer",
    "Improper Restriction of XML External Entity Reference",
    "Improper Sanitization of HTML Tags",
    "Improper Use of Regular Expression",
    "Improper Validation of Array Index",
    "Improper Validation of SSL/TLS Certificates",
    "Improper Verification of Cryptographic Signature",
    "Improper Verification of Integrity Check Value",
    "Improperly Controlled Modification of Dynamically-Determined Object Attributes",
    "Improperly Implemented Security Check for Standard",
    "Inadequate Encryption Strength",
    "Injection",
    "Information Disclosure",
    "Inclusion of Functionality from Untrusted Control Sphere",
    "Inclusion of Sensitive Information in Log Files",
    "Incorrect Behavior Order: Early Amplification",
    "Incorrect Behavior Order: Validate Before Canonicalize",
    "Incorrect Default Permissions",
    "Incorrect Permission Assignment for Critical Resource",
    "Incorrect Type Conversion or Cast",
    "Infinite Loop",
    "Information Exposure Through an Error Message",
    "Input Validation Vulnerability",
    "Insecure Default Configuration",
    "Insecure Direct Object References",
    "Insecure Storage of Sensitive Information",
    "Insufficient Entropy",
    "Insufficient Process Isolation",
    "Insufficient Session Expiration",
    "Insufficient Verification of Data Authenticity",
    "Insufficiently Protected Backup",
    "Insufficiently Protected Credentials",
    "Integer Overflow or Wraparound",
    "Integer Underflow (Wrap or Wraparound)",
    "Lack of Necessary Functionality in a Security Mechanism",
    "Lack of User Control Over Privacy Settings",
    "Local File Inclusion",
    "Memory Corruption Vulnerability",
    "Microsoft Exchange Information Disclosure Vulnerability",
    "Missing Authentication for Critical Function",
    "Missing Authorization",
    "Missing Encryption of Sensitive Data",
    "Missing Function Level Access Control",
    "Missing Password Change Function",
    "Missing Protection Mechanism",
    "Missing Release of Resource after Effective Lifetime",
    "Missing Security Headers",
    "Null Pointer Dereference",
    "Open Redirect vulnerability",
    "Out-of-bounds Read",
    "Out-of-bounds Write",
    "Outlook Web App Token Spoofing Vulnerability",
    "Password in Configuration File",
    "Path Traversal",
    "Prototype Pollution",
    "Race Condition",
    "Race Conditions",
    "Relative Path Traversal",
    "Remote Code Excecution (RCE)",
    "Remote File Inclusion",
    "SMTP Memory Allocation Vulnerability",
    "SQL Injection (SQLi)",
    "Security Misconfiguration",
    "Server-Side Request Forgery (SSRF)",
    "Stack-based Buffer Overflow",
    "Storing Passwords in a Recoverable Format",
    "Uncontrolled Format String",
    "Uncontrolled Resource Consumption",
    "Unnecessary Exposure of Information",
    "Unprotected Transport of Credentials",
    "Unrestricted Upload of File with Dangerous Type",
    "Untrusted Initialization",
    "Untrusted Search Path",
    "Unvalidated Redirects and Forwards",
    "Use After Free",
    "Use of Hard-coded Password",
    "Use of Insufficiently Random Values",
    "Use of Potentially Dangerous Function",
    "Use of a Broken or Risky Cryptographic Algorithm",
    "Weak Password Policy",
    "Weak Password Recovery Mechanism for Forgotten Password",
    "Weak Password Requirements",
    "XML External Entity (XXE)",
    "Plaintext Injection",
    "Privilege Escalation",
    "HTTP Response Splitting"
];

export const findVulnerabilityTypes = (description: string): string[] => {
    const matchedTypes = new Set<string>();
    
    Object.entries(VULNERABILITY_ALIASES).forEach(([keyword, fullName]) => {
        if (description.toLowerCase().includes(keyword.toLowerCase())) {
            matchedTypes.add(fullName);
        }
    });
    
    return Array.from(matchedTypes);
};
